var app=angular.module("app",[]);app.controller("mainController",["$scope","$http",function(a,e,o){a.form_title="Actas de reunión",a.form_btnEdita="Edita",a.form_btnPrint="Imprime",a.form_btnActualiza="Habilita",a.form_btnCierra="Cierra Acta",a.form_btnRegreso="Cancela",a.form_agenda_comiteId="COMITE",a.tituloFormulario="",a.printConAnexos=" Incluye anexos ",a.printSinAnexos=" Solo el acta ",a.titVentana="DESCARGA E IMPRIME ACTA Y SOPORTES",a.detail={},a.empresa=$("#e").val(),a.parametro="",a.nota="",a.acta=0,a.agenda_id=0,a.formato="",a.btnActualiza=!0,a.modalShown=!1;var n,t={agenda_comiteId:0};function r(){comite=a.agenda_comiteId,empresa=a.empresa,e.post("modulos/mod_mm_agendamiento.php?op=rc",{op:"rc",comite_Id:comite,empresa:empresa,param:"excluye"}).success(function(e){"No Hay"==e?alert("Este comité no tiene reuniones convocadas"):a.details=e})}!function(o){var n=$("#u").val();e.post("modulos/mod_mm_agendamiento.php?op=1",{op:"1",empresa:o,user:n}).success(function(e){a.operators1=e})}(a.empresa),a.show_form=!0,(n=angular.module("app",[])).controller("mainController",["modalService",function(a){var e=this;e.result="",e.openModal=function(){a.openModal().then(function(a){e.result=a})}}]),n.controller("modalController",["modalService","$scope",function(a,e){var o=this;o.show=a.modalOn,o.returnValue=a.returnValue,e.$on("MODAL_OPEN",function(){o.show=a.modalOn}),e.$on("MODAL_CLOSE",function(){o.show=a.modalOn})}]),n.service("modalService",["$q","$rootScope",function(a,e){var o=this;o.modalOn=!1,o.openModal=function(){return o.defer=a.defer(),o.modalOn=!0,e.$broadcast("MODAL_OPEN"),o.defer.promise},o.returnValue=function(a){o.modalOn=!1,e.$broadcast("MODAL_CLOSE"),o.defer.resolve(a)}}]),a.formToggle=function(){$("#idForm").slideToggle(),a.formato.$setPristine(),a.registro=angular.copy(t)},a.toggleModal=function(o){a.modalShown=!a.modalShown,a.modalShown&&(agenda=a.details[0].agenda_id,empresa=a.empresa,e.post("modulos/mod_mm_agendaanexos.php?op=pr",{op:"pr",empresa:empresa,agenda:agenda}).success(function(e){a.detailsAnex=e}))},a.updateComite=function(){r()},a.cierraActa=function(o){agenda=a.agenda_id,param=a.parametro,aviso="Cierra acta "+a.acta+" "+a.nota,confirm(aviso+" continua?")&&(empresa=a.empresa,e.post("modulos/mod_mm_agendamiento.php?op=cra",{op:"cra",empresa:empresa,agenda:agenda}).success(function(a){alert(a)}))},a.editInfo=function(e){if(a.agenda_id=e.agenda_id,a.parametro="I",a.aviso="",a.nota=e.agenda_Descripcion,a.acta=e.agenda_acta,"S"==e.agenda_cierraActa&&(a.aviso="** ACTA CERRADA **"),a.tituloFormulario="Habilita "+e.agenda_Descripcion+" para modificarla o enviar nuevamente la citación ",""==e.agenda_observa.trim()){a.parametro="A";var o=e.agenda_fechaDesde.substr(0,10);a.tituloFormulario="Acta: "+e.agenda_acta+" del "+o+"\n"+e.agenda_Descripcion}a.showEdit=!0,a.btnActualiza=!0,"S"==e.agenda_cierraActa&&(a.btnActualiza=!1)},a.anulaRegistro=function(){a.showEdit=!1},a.actualizaRegistro=function(o){agenda=a.agenda_id,param=a.parametro,confirm("A esta acta se le podrá hacer modificaciones. Continua ?")&&e.post("modulos/mod_mm_agendamiento.php?op=ha",{op:"ha",agenda_id:agenda,parametro:param}).success(function(a){"Ok"===a?(r(),alert("Comité habilitado. ")):alert(a)})},a.printInfo=function(o){desc=a.details[0].agenda_Descripcion,a.titVentana="IMPRIME ACTA "+desc,agenda=a.details[0].agenda_id;empresa=a.empresa,e.post("modulos/mod_mm_agendamiento.php?op=rfa",{op:"rfa",empresa:empresa,agenda:agenda}).success(function(e){a.formato=e,e}),location.href="reports/rpt_mm_actas.php?op="+agenda+"&em="+empresa+"&em="+empresa+"&frm="+a.formato+"&tp="+o,"C"==o&&e.post("modulos/mod_mm_agendaanexos.php?op=pr",{op:"pr",empresa:empresa,agenda:agenda}).success(function(a){})}}]);