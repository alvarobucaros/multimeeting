var app=angular.module("app",[]);app.controller("mainController",["$scope","$http",function(a,o){a.form_title="Lista de usuarios",a.form_btnNuevo="Nuevo registro",a.form_btnEdita="Edita",a.form_btnElimina="Elimina",a.form_btnAnula="Cerrar",a.form_btnActualiza="Actualizar",a.form_btnMiembro="Comités",a.form_titModal="Actualiza lista de registros",a.form_Phbusca="Consulta",a.form_Activo50="Administra",a.form_Activo51="Consulta",a.form_Activo52="Digita",a.form_Activo80="Activo",a.form_Activo81="Inactivo",a.form_usuario_id="ID",a.form_usuario_nombre="NOMBRE",a.form_usuario_empresa="EMPRESA",a.form_usuario_email="E.MAIL",a.form_usuario_password="PASSWORD",a.form_usuario_tipo_acceso="ACCESO",a.form_usuario_fechaCreado="FECHA CREADO",a.form_usuario_fechaActualizado="FECHA ACTUALIZADO",a.form_usuario_estado="ESTADO",a.form_usuario_perfil="PERFIL",a.form_usuario_avatar="AVATAR",a.form_usuario_user="USER",a.form_usuario_celular="CELULAR",a.form_Phusuario_id="Digite id",a.form_Phusuario_nombre="Digite nombre",a.form_Phusuario_empresa="Digite empresa",a.form_Phusuario_email="Digite login",a.form_Phusuario_password="Digite password",a.form_Phusuario_tipo_acceso="Digite acceso",a.form_Phusuario_fechaCreado="Digite fecha creado",a.form_Phusuario_fechaActualizado="Digite fecha actualizado",a.form_Phusuario_estado="Digite estado",a.form_Phusuario_perfil="Digite perfil",a.form_Phusuario_avatar="Digite avatar",a.form_Phusuario_user="Digite user",a.form_Phusuario_celular="Digite celular",a.data="????",a.ok="OK",a.cancel="Cancel",a.mimodal=!1,a.titleModal="Miembro de los siguientes comités",a.registro=[],a.empresa=$("#e").val(),a.usuario=$("#u").val(),a.currentPage=0,a.pageSize=10,a.pages=[];function r(){empresa=a.empresa,o.post("modulos/mod_mm_usuarios.php?op=r",{op:"r",empresa:empresa}).success(function(o){a.details=o,a.registro.usuario_perfil=o[0].perfil_nombre,a.configPages()})}empresa=a.empresa,o.post("modulos/mod_mm_usuarios.php?op=0",{op:"0",empresa:empresa}).success(function(o){a.operators0=o}),r(),a.configPages=function(){a.pages.length=0;var o=a.currentPage-4,r=a.currentPage+5;o<1?(o=1,r=Math.ceil(a.details.length/a.pageSize)>10?10:Math.ceil(a.details.length/a.pageSize)):o>=Math.ceil(a.details.length/a.pageSize)-10&&(o=Math.ceil(a.details.length/a.pageSize)-10,r=Math.ceil(a.details.length/a.pageSize)),o<1&&(o=1);for(var e=o;e<=r;e++)a.pages.push({no:e});a.currentPage>=a.pages.length&&(a.currentPage=a.pages.length-1)},a.setPage=function(o){a.currentPage=o-1},a.show_form=!0,a.formToggle=function(){$("#idForm").slideToggle(),a.formato.$setPristine(),a.registro=[],a.registro.usuario_estado="A",a.registro.usuario_tipo_acceso="A",a.registro.usuario_perfil=1,a.registro.usuario_email="",a.registro.usuario_id=0;var o=new Date,r=o.getMonth()+1;fechaHoy=o.getFullYear()+"-"+r+"-"+o.getDate(),a.registro.usuario_fechaCreado=fechaHoy+" T00:00 ",a.registro.usuario_fechaActualizado=fechaHoy+" T00:00 "},a.registro=function(e){empresa=a.empresa,o.post("modulos/mod_mm_usuarios.php?op=a",{op:"a",usuario_id:usuario_id,usuario_nombre:usuario_nombre,usuario_empresa:empresa,usuario_email:usuario_email,usuario_password:usuario_password,usuario_tipo_acceso:usuario_tipo_acceso,usuario_fechaCreado:usuario_fechaCreado,usuario_fechaActualizado:usuario_fechaActualizado,usuario_estado:usuario_estado,usuario_perfil:usuario_perfil,usuario_avatar:usuario_avatar,usuario_user:usuario_user,usuario_celular:usuario_celular}).success(function(o){a.show_form=!0,!0===o&&r()})},a.cambiaNombre=function(){nombre=a.registro.usuario_nombre,alert(nombre)},a.editInfo=function(o){a.registro=o,$("#idForm").slideToggle()},a.deleteInfo=function(a){confirm("Desea borrar el registro con nombre : "+a.usuario_nombre+" ?")&&o.post("modulos/mod_mm_usuarios.php?op=b",{op:"b",usuario_id:a.usuario_id}).success(function(a){"Ok"===a&&(r(),alert("Registro Borrado "))})},a.miembroComites=function(r){a.mimodal=!0,empresa=a.empresa,usuario=a.registro.usuario_id,o.post("modulos/mod_mm_usuarios.php?op=m",{op:"m",empresa:empresa,usuario:usuario}).success(function(o){dt=o.split("||"),a.idx=dt[1],$("#data").html(dt[0])})},a.cancel=function(){a.mimodal=!1},a.ok=function(){valoresCheck=[],usuario=a.usuario,empresa=a.empresa,$("input[type=checkbox]:checked").each(function(){valoresCheck.push(this.value)}),cond="";for(var r=0;r<valoresCheck.length;r++)cond+=valoresCheck[r]+";";o.post("modulos/mod_mm_usuarios.php?op=k",{op:"k",usuario:usuario,empresa:empresa,condicion:cond}).success(function(a){"Ok"===a&&alert("Miembro de comités actualizados")}),a.mimodal=!1},a.updateInfo=function(a){er="",usr=$("#usuario_user").val(),emp=$("#e").val(),""===$("#usuario_id").val()&&(er+="falta id\n"),""===$("#usuario_nombre").val()&&(er+="falta nombre\n"),""===$("#usuario_empresa").val()&&(er+="falta empresa\n"),""===$("#usuario_email").val()&&(er+="falta login\n"),""===$("#usuario_password").val()&&$("#usuario_password").val(usr),""===$("#usuario_tipo_acceso").val()&&(er+="falta acceso\n"),""===$("#usuario_fechaCreado").val()&&(er+="falta fecha creado\n"),""===$("#usuario_fechaActualizado").val()&&(er+="falta fecha actualizado\n"),""===$("#usuario_estado").val()&&(er+="falta estado\n"),""===$("#usuario_perfil").val()&&(er+="falta perfil\n"),""===$("#usuario_avatar").val()&&(er+="falta avatar\n"),""===$("#usuario_user").val()&&(er+="falta user\n"),""===$("#usuario_celular").val()&&(er+="falta celular\n"),""==er?o.post("modulos/mod_mm_usuarios.php?op=a",{op:"a",usuario_id:a.usuario_id,usuario_nombre:a.usuario_nombre,usuario_empresa:emp,usuario_email:a.usuario_email,usuario_password:a.usuario_password,usuario_tipo_acceso:a.usuario_tipo_acceso,usuario_fechaCreado:a.usuario_fechaCreado,usuario_fechaActualizado:a.usuario_fechaActualizado,usuario_estado:a.usuario_estado,usuario_perfil:a.usuario_perfil,usuario_avatar:a.usuario_avatar,usuario_user:a.usuario_user,usuario_celular:a.usuario_celular}).success(function(a){"Ok"===a?(r(),alert("Registro Actualizado "),$("#idForm").slideToggle()):alert(a)}):alert(er)},a.clearInfo=function(a){console.log("empty"),$("#idForm").slideToggle()}}]),app.filter("startFromGrid",function(){return function(a,o){return o=+o,a.slice(o)}});